<!doctype html>
<html>

<head>
    <title>Dice App</title>
<meta name='viewport' content='width=device-width, initial-scale=1.0, user-scalable=no'>
<meta name='theme-color' content='#000'>
<link rel='manifest' href='/manifest.json'>
<link rel='icon' href='/dice.svg' type='image/svg+xml'>
<link rel='apple-touch-icon' href='/dice.svg'>
<style>
html,
body {
    margin: 0;
    padding: 0;
}

body {
    background-color: hsl(200, 20%, 20%);
    color: hsl(40, 40%, 92%);
    display: grid;
    font-family: 'Gill Sans', 'Gill Sans MT', 'Trebuchet MS', sans-serif;
    gap: 12vmin;
    height: 100dvh;
    overflow: hidden;
    place-content: center;
}

:root {
    --background-color: hsl(200, 22%, 90%);
    --border-color: hsl(0, 0%, 5%);
    --border-radius: 1px;
    --border-width: 2vmin;
    --dot-color: hsl(0, 0%, 5%);
    --dot-size: 20%;
    --duration: 2.8s;
    --half-size: calc(var(--size) / 2);
    --opacity: 1;
    --transparent: 0.42;
    --size: 45vmin;
}

.space-3d {
    height: var(--size);
    width: var(--size);
    display: grid;
    perspective-origin: 50% 100%;
    perspective: 150vmin;
    place-content: center;
}

.cube {
    height: var(--size);
    width: var(--size);
    position: relative;
    transform-style: preserve-3d;
    transition: transform var(--duration);
    user-select: none;

    i {
        display: block;
        position: absolute;
        height: var(--dot-size);
        width: var(--dot-size);
        background: var(--dot-color);
        border-radius: 50%;
        top: 20%;
        left: 20%;
        margin-top: calc(var(--dot-size) / -2);
        margin-left: calc(var(--dot-size) / -2);
    }

    aside {
        position: absolute;
        height: 100%;
        width: 100%;
        backface-visibility: hidden;
        background: var(--background-color);
        border-color: var(--border-color);
        border-radius: var(--border-radius);
        border-style: solid;
        border-width: var(--border-width);
        box-sizing: border-box;
        cursor: pointer;
        opacity: var(--opacity);
        transition: opacity var(--duration);
    }
}

.front {
    transform: translateZ(var(--half-size));

    i {
        left: 50%;
        top: 50%;
    }
}

.back {
    transform: rotateX(-180deg) translateZ(var(--half-size));

    > :nth-child(1) {
        left: 80%;
    }

    > :nth-child(2) {
        top: 80%;
    }
}

.right {
    transform: rotateY(90deg) translateZ(var(--half-size));

    > :nth-child(1) {
        left: 80%;
    }

    > :nth-child(2) {
        left: 50%;
        top: 50%;
    }

    > :nth-child(3) {
        top: 80%;
    }
}

.left {
    transform: rotateY(-90deg) translateZ(var(--half-size));

    > :nth-child(2) {
        left: 80%;
    }

    > :nth-child(3) {
        left: 80%;
        top: 80%;
    }

    > :nth-child(4) {
        top: 80%;
    }
}

.top {
    transform: rotateX(90deg) translateZ(var(--half-size));

    > :nth-child(2) {
        left: 50%;
        top: 50%;
    }

    > :nth-child(3) {
        top: 80%;
    }

    > :nth-child(4) {
        left: 80%;
    }

    > :nth-child(5) {
        left: 80%;
        top: 80%;
    }
}

.bottom {
    transform: rotateX(-90deg) translateZ(var(--half-size));

    > :nth-child(2) {
        top: 50%;
    }

    > :nth-child(3) {
        top: 80%;
    }

    > :nth-child(4) {
        left: 80%;
    }

    > :nth-child(5) {
        left: 80%;
        top: 50%;
    }

    > :nth-child(6) {
        left: 80%;
        top: 80%;
    }
}
</style>
</head>

<body>
    <section class='space-3d' role='region' aria-label='Dice container'>
    <div class='cube' role='button' aria-label='Click to roll the dice'>
        <aside class='front'>
            <i></i>
        </aside>
        <aside class='back'>
            <i></i> <i></i>
        </aside>
        <aside class='right'>
            <i></i> <i></i> <i></i>
        </aside>
        <aside class='left'>
            <i></i> <i></i>
            <i></i> <i></i>
        </aside>
        <aside class='top'>
            <i></i> <i></i> <i></i>
            <i></i> <i></i>
        </aside>
        <aside class='bottom'>
            <i></i> <i></i> <i></i>
            <i></i> <i></i> <i></i>
        </aside>
    </div>
</section>

<script>
const diceConfig = {
    title: 'Dice App',
    spinDuration: '0.62s',
    spinStep: 90,
    spinMax: 32,
    min: 1,
    max: 2,
    cssSelector: "[role='button']",
    htmlProps: "role='button' aria-label='Click to roll the dice'",
    parentSelector: "[role='region']",
    parentProps: "role='region' aria-label='Dice container'",
};

const diceEvents = {
    getAll: ({cssSelector}) =>  (
        document.querySelectorAll(cssSelector)
    ),

    dragStart: ({ clientX, clientY }) => {
        state.dragging = true;
        state.startX = clientX;
        state.startY = clientY; 
    },

    drag: (dice, { clientX, clientY }) => {
        if (!state.dragging) return;

        dice.style.setProperty('--duration', '0');
        dice.style.setProperty('--opacity', 'var(--transparent');

        dice.style.transform = getRotation({
            x: state.x - (clientY - state.startY),
            y: state.y + (clientX - state.startX)
        });
    },

    roll: (dice, {spinDuration, ...transformOptions}) => {
        dice.style.setProperty('--duration', spinDuration);
        dice.style.setProperty('--opacity', '1');
        dice.style.transform = setRotation(transformOptions);
    },

    rollAll: ({cssSelector, ...rollOptions}) => {
        if (!state.dragging) return;
        state.dragging = false;
        diceEvents.getAll({cssSelector}).forEach(dice => 
            diceEvents.roll(dice, rollOptions)
        );
    },

    start: ({cssSelector, parentSelector, ...rollOptions}) => {

        diceEvents.getAll({cssSelector}).forEach(dice => {
            dice.addEventListener('pointerdown', diceEvents.dragStart);
            
            dice.addEventListener('pointermove', (event) => {
                requestAnimationFrame(() => {
                    diceEvents.drag(dice, event);
                });
            });
        });

        diceEvents.getAll({cssSelector: parentSelector}).forEach(parent => {
            parent.addEventListener('pointerup', () => {
                diceEvents.rollAll({cssSelector, ...rollOptions})
            });

            parent.addEventListener('pointerleave', () => {
                diceEvents.rollAll({cssSelector, ...rollOptions})
            });
        });
    },
}

const getRotation = ({ x, y }) =>  `rotateX(${ x }deg) rotateY(${ y }deg)`;

const state = {
    dragging: false,
    startX: 0,
    startY: 0,  
    x: 0,
    y: 0,
};
const setRotation = ({spinMax, spinStep, getRandomNumber}) => {
    const numberOptions = { start: 0, length: spinMax, step: spinStep }; 
    state.x = getRandomNumber(numberOptions);
    state.y = getRandomNumber(numberOptions);
    return getRotation(state);
};


const randomizer = {
    getRandomNumber: ({ start = 1, step = 1, length = 6 } = {}) =>
        start + Math.floor(length * Math.random()) * step,
};

diceEvents.start({ ...diceConfig, ...randomizer });

window.addEventListener('load', () => {
    if (!('serviceWorker' in navigator)) return;

    navigator.serviceWorker.register('./cache-worker.js')
});

</script>



</body>

</html>